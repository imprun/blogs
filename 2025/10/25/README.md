# Oracle Cloud + Tailscale + Kubernetes ì™„ë²½ ê°€ì´ë“œ

> Oracle Cloud ë¬´ë£Œ ì¸ìŠ¤í„´ìŠ¤ë¡œ Tailscale ë©”ì‹œ ë„¤íŠ¸ì›Œí¬ ìœ„ì— Kubernetes í´ëŸ¬ìŠ¤í„° êµ¬ì¶•í•˜ê¸°

## ë“¤ì–´ê°€ë©°

[**imprun.dev**](https://imprun.dev)ëŠ” Kubernetes ê¸°ë°˜ ì„œë²„ë¦¬ìŠ¤ Cloud Function í”Œë«í¼ì…ë‹ˆë‹¤. í´ëŸ¬ìŠ¤í„° ì¸í”„ë¼ë¥¼ êµ¬ì¶•í•˜ë©´ì„œ Oracle Cloudì˜ ë¬´ë£Œ ARM64 ì¸ìŠ¤í„´ìŠ¤ì™€ Tailscaleì„ ì¡°í•©í•´ **ë¬´ë£Œë¡œ ê³ ê°€ìš©ì„± ë©€í‹° ë…¸ë“œ í´ëŸ¬ìŠ¤í„°**ë¥¼ êµ¬ì¶•í•œ ê²½í—˜ì„ ì‹œë¦¬ì¦ˆë¡œ ì •ë¦¬í–ˆìŠµë‹ˆë‹¤.

**ìš°ë¦¬ê°€ ë§ˆì£¼í•œ ê³¼ì œ**:
- âœ… **ì˜ˆì‚° ì œì•½**: Oracle Cloud ë¬´ë£Œ í‹°ì–´ë§Œ í™œìš© (4 cores, 24GB RAM per node)
- âœ… **ë©€í‹° ë¦¬ì „**: ì„œë¡œ ë‹¤ë¥¸ Oracle Cloud ê³„ì •ì˜ ì¸ìŠ¤í„´ìŠ¤ ì—°ê²° í•„ìš”
- âŒ **ë¬¸ì œ 1**: ì„œë¡œ ë‹¤ë¥¸ VCN ê°„ Private IP í†µì‹  ë¶ˆê°€
- âŒ **ë¬¸ì œ 2**: Public IPëŠ” ë³´ì•ˆ ìœ„í—˜ + NAT í™˜ê²½ì—ì„œ ë¶ˆì•ˆì •
- âœ… **í•´ê²°**: Tailscale ë©”ì‹œ VPNìœ¼ë¡œ ì•ˆì „í•œ Private ë„¤íŠ¸ì›Œí¬ êµ¬ì„±

**ì‹œí–‰ì°©ì˜¤ì™€ ìµœì¢… ì•„í‚¤í…ì²˜**:
- ì‹œë„ 1: âŒ Tailscaleì„ Kubernetes Podë¡œ ì‹¤í–‰ â†’ ë„¤íŠ¸ì›Œí¬ ë£¨í”„ ë°œìƒ
- ì‹œë„ 2: âŒ Cilium Native Routing + Tailscale Routes â†’ ìˆ˜ë™ ë¼ìš°íŒ… ê´€ë¦¬ ì§€ì˜¥
- ìµœì¢…: âœ… **Tailscale(í˜¸ìŠ¤íŠ¸) + Cilium VXLAN** â†’ ìë™í™” ì„±ê³µ

ì´ ê°€ì´ë“œëŠ” **imprun.dev í”Œë«í¼ êµ¬ì¶• ê³¼ì •ì—ì„œ ê²ªì€ ë©°ì¹ ê°„ì˜ ì‚½ì§ˆ**ì„ ë°”íƒ•ìœ¼ë¡œ, "ë‹¤ìŒì— ì¬êµ¬ì¶•í•  ë•Œ ê·¸ëŒ€ë¡œ ë”°ë¼ í•  ìˆ˜ ìˆë„ë¡" ëª…í™•í•˜ê³  ê°„ê²°í•˜ê²Œ ì •ë¦¬í–ˆìŠµë‹ˆë‹¤.

---

## ğŸ“š ê°€ì´ë“œ êµ¬ì„±

### ğŸ¯ ìµœì¢… ì•„í‚¤í…ì²˜

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   Tailscale Mesh                    â”‚
â”‚                  (100.64.0.0/10)                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Master Node â”‚  Worker #1   â”‚    Worker #2         â”‚
â”‚  100.64.0.1  â”‚  100.64.0.2  â”‚    100.64.0.3       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚         Cilium CNI (VXLAN, UDP 8472)               â”‚
â”‚              Pod Network: 10.244.0.0/16            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### âš ï¸ ì™œ VXLAN í„°ë„ë§ì„ ì‚¬ìš©í•˜ë‚˜ìš”?

**Tailscaleì˜ ì œì•½ì‚¬í•­:**
- Tailscale/Headscaleì€ **ìë™ìœ¼ë¡œ Pod ë„¤íŠ¸ì›Œí¬ ë¼ìš°íŒ…ì„ ì„¤ì •í•˜ì§€ ì•ŠìŒ**
- `--advertise-routes`ë¡œ ë¼ìš°íŠ¸ë¥¼ ê´‘ê³ í•´ë„ ê° ë…¸ë“œì—ì„œ **ìˆ˜ë™ìœ¼ë¡œ ip route ì„¤ì • í•„ìš”**
- ë…¸ë“œê°€ ì¶”ê°€/ì œê±°ë  ë•Œë§ˆë‹¤ ëª¨ë“  ë…¸ë“œì˜ ë¼ìš°íŒ… í…Œì´ë¸” ìˆ˜ë™ ì—…ë°ì´íŠ¸

**ì‹œë„í–ˆë˜ ë°©ë²• (ì‹¤íŒ¨):**
1. âŒ Cilium Native Routing + Tailscale Routes
   - ê° ë…¸ë“œì—ì„œ `ip route add 10.244.x.0/24 via 100.64.0.y` ìˆ˜ë™ ì„¤ì •
   - ë…¸ë“œ ì¶”ê°€ ì‹œë§ˆë‹¤ ëª¨ë“  ë…¸ë“œì—ì„œ ë¼ìš°íŒ… ì—…ë°ì´íŠ¸
   - ìš´ì˜ ë³µì¡ë„ ê¸‰ì¦, ìë™í™” ì–´ë ¤ì›€

**ì„ íƒí•œ ë°©ë²• (ì„±ê³µ):**
2. âœ… Cilium VXLAN Tunneling
   - Ciliumì´ VXLAN í„°ë„ë¡œ Pod ë„¤íŠ¸ì›Œí¬ ìº¡ìŠí™”
   - Tailscaleì€ ë‹¨ìˆœíˆ ë…¸ë“œ ê°„ í„°ë„ë§Œ ì œê³µ
   - ë¼ìš°íŒ… ìë™ ê´€ë¦¬, ë…¸ë“œ ì¶”ê°€ ì‹œ ì„¤ì • ë¶ˆí•„ìš”

**íŠ¸ë ˆì´ë“œì˜¤í”„:**
- ì„±ëŠ¥: VXLAN ì˜¤ë²„í—¤ë“œ ì•½ 5-10% (ì‹¤ë¬´ì—ì„œëŠ” ë¬´ì‹œ ê°€ëŠ¥)
- ì•ˆì •ì„±: ë¼ìš°íŒ… ìë™í™”ë¡œ ìš´ì˜ ì•ˆì •ì„± â†‘â†‘â†‘
- ê²°ë¡ : **ìš´ì˜ í¸ì˜ì„± >> ë¯¸ì„¸í•œ ì„±ëŠ¥ ì°¨ì´**

### ğŸ“– ë¬¸ì„œ ëª©ì°¨

#### 1ë‹¨ê³„: ì¤€ë¹„ (Preparation)
- [**01-preparation-oracle-cloud.md**](01-preparation-oracle-cloud.md)
  - Oracle Cloud ë¬´ë£Œ ê³„ì • ìƒì„±
  - VCN, Subnet, Security List êµ¬ì„±
  - ì¸ìŠ¤í„´ìŠ¤ ìƒì„± ë° SSH ì ‘ì†
  - ê¸°ë³¸ ì‹œìŠ¤í…œ ì„¤ì •

#### 2ë‹¨ê³„: ë„¤íŠ¸ì›Œí¬ êµ¬ì¶• (Network Setup)
- [**02-setup-tailscale-network.md**](02-setup-tailscale-network.md)
  - Tailscale ì„¤ì¹˜ ë° ì—°ê²°
  - ë…¸ë“œ ê°„ ë©”ì‹œ ë„¤íŠ¸ì›Œí¬ êµ¬ì„±
  - MTU ìµœì í™” ë° ë°©í™”ë²½ ì„¤ì •

- [**02a-setup-headscale-server.md**](02a-setup-headscale-server.md) *(ì„ íƒì‚¬í•­)*
  - ìì²´ í˜¸ìŠ¤íŒ… Headscale ì„œë²„ êµ¬ì¶•
  - HTTPS ì¸ì¦ì„œ ì„¤ì • (Let's Encrypt)
  - ë…¸ë“œ ë“±ë¡ ë° ê´€ë¦¬

#### 3ë‹¨ê³„: í´ëŸ¬ìŠ¤í„° êµ¬ì¶• (Cluster Setup)
- [**03-setup-kubernetes-cilium.md**](03-setup-kubernetes-cilium.md)
  - Kubernetes 1.34.1 ì„¤ì¹˜
  - kubeadm ì´ˆê¸°í™”
  - Cilium 1.18.2 CNI ì„¤ì¹˜ (VXLAN)
  - ì›Œì»¤ ë…¸ë“œ ì¡°ì¸
  - **Phase 7 (ì˜µì…”ë„)**: ë§ˆìŠ¤í„° ë…¸ë“œ ì›Œí¬ë¡œë“œ ìŠ¤ì¼€ì¤„ë§ ì„¤ì •
    - ì†Œê·œëª¨ í´ëŸ¬ìŠ¤í„°: taint ì œê±° (ë§ˆìŠ¤í„°ì— ì›Œí¬ë¡œë“œ í—ˆìš©)
    - í‘œì¤€ êµ¬ì„±: taint ìœ ì§€ (ì»¨íŠ¸ë¡¤í”Œë ˆì¸ ì „ìš©)

#### 4ë‹¨ê³„: ì‹¬í™” í•™ìŠµ (Deep Dive)
- [**04-deep-dive-networking.md**](04-deep-dive-networking.md)
  - Tailscale WireGuard í„°ë„ë§ ì´í•´
  - Cilium eBPF ë„¤íŠ¸ì›Œí‚¹ ë™ì‘ ì›ë¦¬
  - VXLAN ì˜¤ë²„ë ˆì´ ë„¤íŠ¸ì›Œí¬
  - íŠ¸ë˜í”½ í”Œë¡œìš° ë¶„ì„

#### 5ë‹¨ê³„: ì‹¤ì „ ê²½í—˜ (Lessons Learned)
- [**05-lessons-learned.md**](05-lessons-learned.md)
  - Tailscaleì„ Kubernetes ë‚´ë¶€ì—ì„œ ì‹¤í–‰ ì‹œë„ (ì‹¤íŒ¨)
  - Cilium Native Routing ì‹œë„ (ì‹¤íŒ¨)
  - ìµœì¢… ì•„í‚¤í…ì²˜ ê²°ì • ë°°ê²½
  - ì‚½ì§ˆì—ì„œ ì–»ì€ êµí›ˆ

### âš¡ ë¹ ë¥¸ ì‹œì‘

ìµœì†Œ êµ¬ì„±ìœ¼ë¡œ ë¹ ë¥´ê²Œ ì‹œì‘í•˜ë ¤ë©´:

1. **Oracle Cloud ì¸ìŠ¤í„´ìŠ¤ 2ê°œ ìƒì„±** (ARM64 ì¶”ì²œ)
2. **ê° ë…¸ë“œì—ì„œ ì‹¤í–‰**:
   ```bash
   # Tailscale ì„¤ì¹˜
   curl -fsSL https://tailscale.com/install.sh | sh
   sudo tailscale up

   # Kubernetes ì„¤ì¹˜ (03-setup-kubernetes-cilium.md ì°¸ì¡°)
   ```

### ğŸ“‹ ì²´í¬ë¦¬ìŠ¤íŠ¸

#### í•„ìˆ˜ ì‘ì—…
- [ ] Oracle Cloud ê³„ì • ë° ì¸ìŠ¤í„´ìŠ¤ ì¤€ë¹„
- [ ] Tailscale ë©”ì‹œ ë„¤íŠ¸ì›Œí¬ êµ¬ì„±
- [ ] Kubernetes ë§ˆìŠ¤í„° ë…¸ë“œ ì´ˆê¸°í™”
- [ ] Cilium CNI ì„¤ì¹˜ ë° ì„¤ì •
- [ ] ì›Œì»¤ ë…¸ë“œ ì¶”ê°€
- [ ] í´ëŸ¬ìŠ¤í„° ë™ì‘ ê²€ì¦
- [ ] ì‹¤ì „ ê²½í—˜ ë¬¸ì„œ ì½ê¸° (í•¨ì • íšŒí”¼)

#### ì˜µì…”ë„ ì‘ì—…
- [ ] ë§ˆìŠ¤í„° ë…¸ë“œ taint ì„¤ì • ê²°ì • (Phase 7)
  - ì›Œì»¤ 3ê°œ ì´ìƒ: taint ìœ ì§€ (ì»¨íŠ¸ë¡¤í”Œë ˆì¸ ì „ìš©) âœ… ê¶Œì¥
  - ì›Œì»¤ 1-2ê°œ: taint ì œê±° (ë¦¬ì†ŒìŠ¤ íš¨ìœ¨) âš ï¸ ê°œë°œ/í…ŒìŠ¤íŠ¸ë§Œ
- [ ] ì›Œì»¤ ë…¸ë“œ ì—­í•  ë¼ë²¨ë§ (ê²Œì´íŠ¸ì›¨ì´ ì „ìš© ë“±)

### ğŸ” ê²€ì¦ëœ í™˜ê²½

- **Oracle Cloud**: ARM64 (Ampere A1) 4 OCPU, 24GB RAM
- **OS**: Ubuntu 22.04 LTS
- **Kubernetes**: v1.34.1
- **Cilium**: v1.18.2
- **Tailscale**: ìµœì‹  ë²„ì „

### ğŸ“ ì°¸ê³ ì‚¬í•­

ì´ ê°€ì´ë“œëŠ” ì‹¤ì œ êµ¬ì¶• ê³¼ì •ì—ì„œ ë°œìƒí•œ ë¬¸ì œë“¤ì„ í•´ê²°í•˜ë©° ì‘ì„±ë˜ì—ˆìŠµë‹ˆë‹¤.
"ë‹¤ìŒì— ì¬êµ¬ì¶•í•  ë•Œ ê·¸ëŒ€ë¡œ ë”°ë¼ í•  ìˆ˜ ìˆë„ë¡" ëª…í™•í•˜ê³  ê°„ê²°í•˜ê²Œ ì •ë¦¬í–ˆìŠµë‹ˆë‹¤.
